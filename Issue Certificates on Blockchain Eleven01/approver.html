<!doctype html>
<html lang="en">
   <head class="approver-bgcolor">
      <!-- Required meta tags -->
      <meta charset="utf-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

      <meta name="keywords" content="....">
      <meta name="description" content="....">
      <link rel="shortcut icon" type="image/png" href="images/tech1.png"/>
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="css/custom.css" />
      <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
      <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	  -->
	  
	  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous">
     </script>
<script>

        // if (typeof web3 !== "undefined") {
        //     web3 = new Web3(web3.currentProvider);
        // } else {
        //     web3 = new Web3(new Web3.providers.HttpProvider("http://13.83.91.1:8083/api/node/rpc"));
        //   }

        //Replace with your ABI

        var abi = [
										{
											"constant": true,
											"inputs": [
												{
													"name": "Issuer",
													"type": "address"
												}
											],
											"name": "getCertificateTxns",
											"outputs": [
												{
													"name": "",
													"type": "string"
												},
												{
													"name": "",
													"type": "string"
												},
												{
													"name": "",
													"type": "string"
												},
												{
													"name": "",
													"type": "string"
												},
												{
													"name": "",
													"type": "string"
												},
												{
													"name": "",
													"type": "uint256"
												},
												{
													"name": "",
													"type": "uint256"
												}
											],
											"payable": false,
											"stateMutability": "view",
											"type": "function"
										},
										{
											"constant": true,
											"inputs": [
												{
													"name": "",
													"type": "uint256"
												}
											],
											"name": "certificateData",
											"outputs": [
												{
													"name": "Id",
													"type": "uint256"
												},
												{
													"name": "Issuer",
													"type": "address"
												},
												{
													"name": "EmpId",
													"type": "string"
												},
												{
													"name": "IssuerName",
													"type": "string"
												},
												{
													"name": "CandidateName",
													"type": "string"
												},
												{
													"name": "CourseName",
													"type": "string"
												},
												{
													"name": "Location",
													"type": "string"
												},
												{
													"name": "DateOfStart",
													"type": "uint256"
												},
												{
													"name": "DateOfCompletion",
													"type": "uint256"
												},
												{
													"name": "NumHours",
													"type": "uint256"
												}
											],
											"payable": false,
											"stateMutability": "view",
											"type": "function"
										},
										{
											"constant": false,
											"inputs": [
												{
													"name": "EmpId",
													"type": "string"
												},
												{
													"name": "IssuerName",
													"type": "string"
												},
												{
													"name": "CandidateName",
													"type": "string"
												},
												{
													"name": "CourseName",
													"type": "string"
												},
												{
													"name": "Location",
													"type": "string"
												},
												{
													"name": "DateOfStart",
													"type": "uint256"
												},
												{
													"name": "DateOfCompletion",
													"type": "uint256"
												},
												{
													"name": "NumHours",
													"type": "uint256"
												}
											],
											"name": "certificateIssue",
											"outputs": [],
											"payable": false,
											"stateMutability": "nonpayable",
											"type": "function"
										},
										{
											"constant": true,
											"inputs": [],
											"name": "certificateDataCount",
											"outputs": [
												{
													"name": "",
													"type": "uint256"
												}
											],
											"payable": false,
											"stateMutability": "view",
											"type": "function"
										},
										{
											"constant": true,
											"inputs": [],
											"name": "admin",
											"outputs": [
												{
													"name": "",
													"type": "address"
												}
											],
											"payable": false,
											"stateMutability": "view",
											"type": "function"
										},
										{
											"inputs": [],
											"payable": false,
											"stateMutability": "nonpayable",
											"type": "constructor"
										},
										{
											"anonymous": false,
											"inputs": [
												{
													"indexed": false,
													"name": "EmpId",
													"type": "string"
												},
												{
													"indexed": false,
													"name": "IssuerName",
													"type": "string"
												},
												{
													"indexed": false,
													"name": "CandidateName",
													"type": "string"
												},
												{
													"indexed": false,
													"name": "CourseName",
													"type": "string"
												},
												{
													"indexed": false,
													"name": "Location",
													"type": "string"
												},
												{
													"indexed": false,
													"name": "DateOfStart",
													"type": "uint256"
												},
												{
													"indexed": false,
													"name": "DateOfCompletion",
													"type": "uint256"
												},
												{
													"indexed": false,
													"name": "NumHours",
													"type": "uint256"
												}
											],
											"name": "CertificateEvent",
											"type": "event"
										}
									];
        //Replace with your contract address

        var contractAddress =
            "0x3d124c05acb14cb117c892953ab6f026fedd9cf4";

        async function init() {
            window.addEventListener('load', async () => {
                if (window.ethereum) {
                    window.web3 = new Web3(window.ethereum);
                    await window.ethereum.enable();
                    var web3 = new Web3(Web3.givenProvider)
                    var accounts = await web3.eth.getAccounts();

                    account = accounts[0];
                    Certificate = await new web3.eth.Contract(abi, contractAddress);
                    console.log(Certificate)
                    console.log(accounts)
                }
                else {
                    console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
                }
            })
            
        }
        init();

        async function getCertificates() {
            var certificateData = document.getElementById('issuerid').value;
            console.log("data is: ", certificateData)

            Certificate.methods.getCertificateTxns(certificateData).call().then(function (data) {
                console.log("data is: ", data);

                var tr;

                tr = $('<tr/>');
                tr.append("<td>" + data.EmpId + "</td>");
                tr.append("<td>" + data.IssuerName + "</td>");
                tr.append("<td>" + data.CandidateName + "</td>");
                tr.append("<td>" + data.CourseName + "</td>");
                tr.append("<td>" + data.Location + "</td>");
                tr.append("<td>" + data.DateOfCompletion + "</td>");
                tr.append("<td>" + data.DateOfStart + "</td>");
                $('table.table').append(tr);

            });
        }
        document.getElementById('certificates').addEventListener('click',getCertificates);


    </script>
 
 <title>Tech Mahindra</title> 
 </head>
 <body class="approver-bgcolor">
        <header>
                <div>
                   <div class="row">
                      <div class="col-md-4 col">
                         <a href="index.html" class="logo mywallet">
                         <img alt="TechMahindra" src="images/tech1.png" class="">
                         </a>
                      </div>
                      <div class="col-md-6 col approver-header">
                            <h2>Certificate Details</h2>
                         </div>
                         <div class="col-md-2 col approver-header">
                             <h4>Approve/Reject</h4>  
                             </div>
                    </div>

                    <div class="row">
                        <div class="col-md-3"></div>
                        <div class="col-md-1">
                             <input type="text" id="issuerid"/>
                        </div>
                        <div class="col-md-1"></div>
                        <div class="col-md-7">
                            <button id="certificates" class="btn our-buttons buttons-common-4">GetCertificates</button>
                        </div>
                    </div>
                    <div class="row">
                            <div class="col-md-10" col>
                                    <table class="table">
                                            <tr>
                                                <th>EmpId</th>
                                                <th>IssuerName</th>
                                                <th>CandidateName</th>
                                                <th>CourseName</th>
                                                <th>Location</th>
                                                <th>DateOfCompletion</th>
                                                <th>DateOfStart</th> 
                                              
                                            </tr>
                                        </table>
                                </div>
                                <div class="col-md-2 col">
                                        <!-- <button id="button" class="btn our-buttons buttons-common-4">Approve
                                            </button>
                                            <button id="button" class="btn our-buttons buttons-common-4">Reject
                                                </button>  -->
                                </div>
                    </div

                     </div>
             </header>
 <div class="container">
     <div class="row">

   </div>
 </div>
 </body>
 </html>